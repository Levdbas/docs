<h2 id="setup-a-testing-environment-with-phpunit">Setup a testing environment with PHPUnit <a class="directLink" href="#setup-a-testing-environment-with-phpunit">#</a></h2><p>Follow the setup steps for <a href="https://github.com/Varying-Vagrant-Vagrants/VVV">Varying Vagrant Vagrants</a>. If you’re having trouble I recommend starting 100% fresh (uninstall and delete everything including VirtualBox). For this walk-through we’re going to start from scratch:</p><h3 id="1.-install-vvv">1. Install VVV <a class="directLink" href="#1.-install-vvv">#</a></h3><p>Follow the <a href="https://varyingvagrantvagrants.org/docs/en-US/installation/">setup instructions</a> — don't forget to install VirtualBox and Vagrant first! For this tutorial I'm going to assume you've installed into <code>~/vagrant-local/</code></p><h3 id="2.-set-up-timber-for-tests">2. Set up Timber for tests <a class="directLink" href="#2.-set-up-timber-for-tests">#</a></h3><p>Navigate into the <code>www</code> directory and clone Timber...</p><pre><code>$ cd ~/vagrant-local/www/
$ git clone git@github.com:timber/timber.git
</code></pre><h3 id="3.-install-wordpresss-development-version">3. Install WordPress's Development Version <a class="directLink" href="#3.-install-wordpresss-development-version">#</a></h3><p>VVV no longer installs the development version of WordPress by default so we have to re-provision with it enabled. Edit <code>vvv-custom.yml</code> and find this line:</p><pre><code>  wordpress-trunk:
    skip_provisioning: true # provisioning this one takes longer, so it's disabled by default
</code></pre><p>Set <code>skip_provisioning</code> to <code>false</code></p><pre><code>  wordpress-trunk:
    skip_provisioning: false # provisioning this one takes longer, so it's disabled by default
</code></pre><p>Now re-provision Vagrant</p><pre><code>$ vagrant halt &amp;&amp; vagrant up --provision
</code></pre><p>Warning: this one will take a while.</p><h3 id="4.-configure-wordpress-tests">4. Configure WordPress tests <a class="directLink" href="#4.-configure-wordpress-tests">#</a></h3><p>Copy <code>/wordpress-trunk/public_html/wp-tests-config-sample.php</code> to <code>/wordpress-trunk/public_html/wp-tests-config.php</code>. Assuming you're using VVV's defaults, we just need to specify how to access the database:</p><pre class="language-php"><code class="language-php"><span class="token function">define</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'DB_NAME'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'wordpress_unit_tests'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">define</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'DB_USER'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'root'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">define</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'DB_PASSWORD'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'root'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="5.-install-wordpress-tests">5. Install WordPress tests <a class="directLink" href="#5.-install-wordpress-tests">#</a></h3><p>SSH into Vagrant to install Timber's tests and run them</p><pre><code>$ vagrant ssh
</code></pre><p>Now, navigate to where you installed Timber via Git:</p><pre><code>$ cd /srv/www/timber
</code></pre><p>And install the tests!</p><pre><code>$ bin/install-wp-tests.sh wordpress_tests root root
</code></pre><p>All done! Now, the fun part (and the only part you have to do in the future when writing/running tests)</p><h3 id="6.-run-the-tests!">6. Run the tests! <a class="directLink" href="#6.-run-the-tests!">#</a></h3><p>Connect to your Vagrant instance trough SSH (if you're not already):</p><pre><code>$ vagrant ssh
</code></pre><p>Now wait for it to bring you into the virtual box from the virtual environment...</p><pre><code>$ cd /srv/www/timber
$ composer install
$ phpunit
</code></pre><p>You should see a bunch of gobbledygook across your screen (the whole process will take about 4 mins.), but we should see that WordPress is testing successfully. Hurrah! For more info, check out the <a href="http://make.wordpress.org/core/handbook/automated-testing/">Handbook on Automated Testing</a>.</p><h2 id="writing-tests">Writing tests <a class="directLink" href="#writing-tests">#</a></h2><p>Now we get to the good stuff. You can add tests to the <code>timber/tests</code> directory. Any new features should be covered by tests. You can be a hero and help write tests for existing methods and functionality.</p><h2 id="gotchas!">Gotchas! <a class="directLink" href="#gotchas!">#</a></h2><ul><li>You may need to setup authorization between VVV and GitHub. Just follow the prompts to create a token if that interrupts the <code>composer install</code>.</li><li>You may have <a href="https://getcomposer.org/doc/articles/troubleshooting.md#proc-open-fork-failed-errors">memory problems with Composer</a>. In case that happens, here’s the script I run:</li></ul><pre><code>sudo /bin/dd if=/dev/zero of=/var/swap.1 bs=1M count=1024
sudo /sbin/mkswap /var/swap.1
sudo /sbin/swapon /var/swap.1
</code></pre>