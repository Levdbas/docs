<h2 id="point-of-entry-main-woocommerce-php-file">Point of entry - main WooCommerce PHP file <a class="directLink" href="#point-of-entry-main-woocommerce-php-file">#</a></h2><p>The first step to get your WooCommerce project integrated with Timber is declaring WooCommerce support in your theme’s <strong>functions.php</strong> file like so:</p><pre class="language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">theme_add_woocommerce_support</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">add_theme_support</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'woocommerce'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'after_setup_theme'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'theme_add_woocommerce_support'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>For more information about how you can enable or disable features and change settings through theme support, refer to the <a href="https://docs.woocommerce.com/document/woocommerce-theme-developer-handbook">WooCommerce Theme Developer Handbook</a>.</p><p>Once that’s done you can start integrating WooCommerce into your theme by creating a file named <strong>woocommerce.php</strong> in the root of your theme. That will establish the context and data to be passed to your Twig files:</p><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><br><br><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">class_exists</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'Timber'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">echo</span> <span class="token single-quoted-string string">'Timber not activated. Make sure you activate the plugin in &lt;a href="/wp-admin/plugins.php#timber">/wp-admin/plugins.php&lt;/a>'</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">return</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token variable">$context</span>            <span class="token operator">=</span> Timber<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token variable">$context</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'sidebar'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Timber<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get_widgets</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'shop-sidebar'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">is_singular</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'product'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token variable">$context</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'post'</span><span class="token punctuation">]</span>    <span class="token operator">=</span> Timber<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get_post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token variable">$product</span>            <span class="token operator">=</span> <span class="token function">wc_get_product</span><span class="token punctuation">(</span> <span class="token variable">$context</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'post'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">ID</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token variable">$context</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'product'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$product</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Get related products</span><br>    <span class="token variable">$related_limit</span>               <span class="token operator">=</span> <span class="token function">wc_get_loop_prop</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'columns'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token variable">$related_ids</span>                 <span class="token operator">=</span> <span class="token function">wc_get_related_products</span><span class="token punctuation">(</span> <span class="token variable">$context</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'post'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">,</span> <span class="token variable">$related_limit</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token variable">$context</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'related_products'</span><span class="token punctuation">]</span> <span class="token operator">=</span>  Timber<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get_posts</span><span class="token punctuation">(</span> <span class="token variable">$related_ids</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Restore the context and loop back to the main query loop.</span><br>    <span class="token function">wp_reset_postdata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    Timber<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">render</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'views/woo/single-product.twig'</span><span class="token punctuation">,</span> <span class="token variable">$context</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    <span class="token variable">$posts</span> <span class="token operator">=</span> Timber<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get_posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token variable">$context</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'products'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$posts</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">is_product_category</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token variable">$queried_object</span> <span class="token operator">=</span> <span class="token function">get_queried_object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token variable">$term_id</span> <span class="token operator">=</span> <span class="token variable">$queried_object</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">term_id</span><span class="token punctuation">;</span><br>        <span class="token variable">$context</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'category'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">get_term</span><span class="token punctuation">(</span> <span class="token variable">$term_id</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'product_cat'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token variable">$context</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">single_term_title</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span> <span class="token boolean constant">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    Timber<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">render</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'views/woo/archive.twig'</span><span class="token punctuation">,</span> <span class="token variable">$context</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></span></code></pre><p>You will now need the two Twig files loaded from <code>woocommerce.php</code>: <code>views/woo/single-product.twig</code> and <code>views/woo/archive.twig</code>.</p><h2 id="archives">Archives <a class="directLink" href="#archives">#</a></h2><p>Create a Twig file according to the location asked by the above file, in this example that would be <code>views/woo/archive.twig</code>:</p><pre class="language-twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">extends</span></span> <span class="token string"><span class="token punctuation">'</span>base.twig<span class="token punctuation">'</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">block</span></span> <span class="token property">content</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br>    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>woocommerce_before_main_content<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br>    <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>before-shop-loop<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><br>        <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>woocommerce_before_shop_loop<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>    <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loop<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><br>        <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">for</span></span> <span class="token property">post</span> <span class="token operator">in</span> <span class="token property">products</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>            <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">include</span></span> <span class="token punctuation">[</span><span class="token string"><span class="token punctuation">"</span>partials/tease-product.twig<span class="token punctuation">"</span></span><span class="token punctuation">]</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>        <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endfor</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>    <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span><br><br>    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>woocommerce_after_shop_loop<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>woocommerce_after_main_content<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endblock</span></span>  <span class="token rd"><span class="token punctuation">%}</span></span></span></code></pre><p>You’ll notice the inclusion of several of WooCommerce’s default hooks, which you’ll need to keep the integration seamless and allow any WooCommerce extension plugin to still work.</p><p>Next, we’ll take care of the single product view.</p><h2 id="single-product">Single Product <a class="directLink" href="#single-product">#</a></h2><p>Create a Twig file according to the location asked by the above file, in this example that would be <code>views/woo/single-product.twig</code>:</p><pre class="language-twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">extends</span></span> <span class="token string"><span class="token punctuation">"</span>base.twig<span class="token punctuation">"</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">block</span></span> <span class="token property">content</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br>    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>woocommerce_before_single_product<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br>    <span class="token other">&lt;article itemscope itemtype="http://schema.org/Product" class="single-product-details</span> <span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">class</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">"><br><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>entry-images<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><br>            <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>woocommerce_before_single_product_summary<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br>            <span class="token other">&lt;img src="</span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">thumbnail</span><span class="token punctuation">.</span><span class="token property">src</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>shop_single<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">" /><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>summary entry-summary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><br>            <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>woocommerce_single_product_summary<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>        <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span><br><br>        <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>woocommerce_after_single_product_summary<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br>        <span class="token other">&lt;meta itemprop="url" content="</span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">link</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">" /><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span></span><br><br>    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">include</span></span> <span class="token punctuation">[</span><span class="token string"><span class="token punctuation">"</span>partials/tease-product.twig<span class="token punctuation">"</span></span><span class="token punctuation">]</span> <span class="token property">with</span> <span class="token punctuation">{</span> <span class="token property">products</span><span class="token punctuation">:</span> <span class="token property">related_products</span> <span class="token punctuation">}</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br>    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>woocommerce_after_single_product<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endblock</span></span>  <span class="token rd"><span class="token punctuation">%}</span></span></span></code></pre><p>Again we are keeping things simple by using WooCommerce’s default hooks. If you need to override the output of any of those hooks, my advice would be to remove and add the relevant actions using PHP, keeping your upgrade path simple.</p><p>If you wanna use the same <code>tease-product.twig</code> output as your related products, you have to remove the default related-products from theme, add the following to your <code>functions.php</code> file: <code>remove_action( 'woocommerce_after_single_product_summary', 'woocommerce_output_related_products', 20 );</code></p><p>Finally, we’ll need to create a teaser file for products in loops. Considering the code above that would be <code>views/partials/tease-product.twig</code>:</p><h2 id="tease-product">Tease Product <a class="directLink" href="#tease-product">#</a></h2><pre class="language-twig"><code class="language-twig"><span class="token other">&lt;article</span> <span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">fn</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>post_class<span class="token punctuation">'</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string"><span class="token punctuation">'</span>$classes<span class="token punctuation">'</span></span><span class="token punctuation">,</span> <span class="token string"><span class="token punctuation">'</span>entry<span class="token punctuation">'</span></span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">></span><br><br>    <span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">fn</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>timber_set_product<span class="token punctuation">'</span></span><span class="token punctuation">,</span> <span class="token property">post</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><br><br>    <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>media<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><br><br>        <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">if</span></span> <span class="token property">showthumb</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>            <span class="token other">&lt;div class="media-figure</span> <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">if</span></span> <span class="token operator">not</span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">thumbnail</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span class="token other">placeholder</span><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endif</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span class="token other">"><br>                &lt;a href="</span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">link</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">"></span><br>                    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">if</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">thumbnail</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>                        <span class="token other">&lt;img src="</span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">thumbnail</span><span class="token punctuation">.</span><span class="token property">src</span><span class="token operator">|</span><span class="token property">resize</span><span class="token punctuation">(</span><span class="token property">post_thumb_size</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">post_thumb_size</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">" /></span><br>                    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">else</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>                        <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>thumb-placeholder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon-camera<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></span><br>                    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endif</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>                <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span><br>        <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endif</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br>        <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>media-content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><br><br>            <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>woocommerce_before_shop_loop_item_title<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br>            <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">if</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">title</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>                <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>entry-title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&lt;a href="</span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">link</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">"></span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">title</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span></span><br>            <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">else</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>                <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>entry-title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&lt;a href="</span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">link</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">"></span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">fn</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>the_title<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span></span><br>            <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endif</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br>            <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span> <span class="token string"><span class="token punctuation">'</span>woocommerce_after_shop_loop_item_title<span class="token punctuation">'</span></span> <span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>            <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">do</span></span> <span class="token property">action</span><span class="token punctuation">(</span> <span class="token string"><span class="token punctuation">'</span>woocommerce_after_shop_loop_item<span class="token punctuation">'</span></span> <span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br><br>        <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span></span></code></pre><p>This should all sound familiar by now, except for one line:</p><pre class="language-twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">fn</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>timber_set_product<span class="token punctuation">'</span></span><span class="token punctuation">,</span> <span class="token property">post</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span></code></pre><p>For some reason, products in the loop don’t get the right context by default. This line will call the following function that you need to add somewhere in your <code>functions.php</code> file:</p><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><br><span class="token keyword">function</span> <span class="token function">timber_set_product</span><span class="token punctuation">(</span> <span class="token variable">$post</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">global</span> <span class="token variable">$product</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">is_woocommerce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token variable">$product</span> <span class="token operator">=</span> <span class="token function">wc_get_product</span><span class="token punctuation">(</span> <span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">ID</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></span></code></pre><p>Without this, some elements of the listed products would show the same information as the first product in the loop. If you see an error like <code>Warning: call_user_func_array() expects parameter 1 to be a valid callback, no array or string given</code>, this is your problem.</p><p><em>Note:</em> Some users reported issues with the loop context even when using the <code>timber_set_product()</code> helper function. Turns out the default WooCommerce hooks interfere with the output of the aforementioned function.</p><p>One way to get around this is by building your own image calls, that means removing WooCommerce’s default hooks and declare your own template for the HTML to show the image:</p><pre class="language-twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">if</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">thumbnail</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><br>    <span class="token other">&lt;img src="</span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">post</span><span class="token punctuation">.</span><span class="token property">thumbnail</span><span class="token punctuation">.</span><span class="token property">src</span><span class="token operator">|</span><span class="token property">resize</span><span class="token punctuation">(</span><span class="token property">shop_thumbnail_image_size</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">" /></span><br><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endif</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span></code></pre><p>To remove the default image, add the following to your <code>functions.php</code> file:</p><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><br><span class="token function">remove_action</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'woocommerce_before_shop_loop_item_title'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'woocommerce_template_loop_product_thumbnail'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>This comes with the added benefit that you’ll have total control over where your image is created in the markup.</p>